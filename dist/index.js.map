{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import type { Plugin, Action, IAgentRuntime, Memory, State, HandlerCallback, Content } from '@elizaos/core';\nimport { logger } from '@elizaos/core';\nimport { z } from 'zod';\nimport fetch from 'node-fetch';\n\nconst configSchema = z.object({\n  OPENAI_API_KEY: z.string().min(1, 'OPENAI_API_KEY is required'),\n  GITHUB_TOKEN: z.string().optional(),\n});\n\nexport interface RepoInfo {\n  name: string;\n  description: string | null;\n}\n\nexport async function fetchRepositories(user: string, token?: string): Promise<RepoInfo[]> {\n  const url = `https://api.github.com/users/${user}/repos`;\n  const headers: Record<string, string> = { Accept: 'application/vnd.github+json' };\n  if (token) headers.Authorization = `Bearer ${token}`;\n  const res = await fetch(url, { headers });\n  if (!res.ok) {\n    throw new Error(`Failed to fetch repos for ${user}: ${res.status} ${res.statusText}`);\n  }\n  const data = (await res.json()) as any[];\n  return data.map((repo) => ({ name: repo.name, description: repo.description }));\n}\n\nexport function createComicPrompt(repos: RepoInfo[], user: string): string {\n  const top = repos.slice(0, 3).map((r) => `${r.name}: ${r.description ?? 'No description'}`).join('\\n');\n  return `Create a four panel comic strip summarizing GitHub user ${user}'s repositories.\\n${top}`;\n}\n\nexport interface ImageResult { url: string }\n\n// Define the expected OpenAI API response structure\ninterface OpenAIImageResponse {\n  data: Array<{\n    url: string;\n  }>;\n}\n\nexport async function generateComicImage(prompt: string, apiKey: string): Promise<ImageResult> {\n  const res = await fetch('https://api.openai.com/v1/images/generations', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      Authorization: `Bearer ${apiKey}`,\n    },\n    body: JSON.stringify({ model: 'dall-e-3', prompt }),\n  });\n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(`OpenAI error: ${res.status} ${text}`);\n  }\n  const data = await res.json() as OpenAIImageResponse;\n  return { url: data.data[0].url };\n}\n\nconst generateComicAction: Action = {\n  name: 'GITHUB_COMICS',\n  similes: ['REPO_COMICS'],\n  description: 'Generate comic strip from GitHub repos',\n  validate: async () => true,\n  handler: async (\n    _runtime: IAgentRuntime,\n    message: Memory,\n    _state: State,\n    options: any,\n    callback: HandlerCallback,\n  ) => {\n    const user = options?.user || message.content.text?.trim();\n    if (!user) throw new Error('GitHub user not specified');\n    const { OPENAI_API_KEY, GITHUB_TOKEN } = config;\n    const repos = await fetchRepositories(user, GITHUB_TOKEN);\n    const prompt = createComicPrompt(repos, user);\n    const image = await generateComicImage(prompt, OPENAI_API_KEY);\n    const quip = `Wow ${user}, your code is... something else. Keep it up!`;\n    const content: Content = {\n      text: `${quip}\\n${image.url}`,\n    };\n    await callback(content);\n    return content;\n  },\n  examples: [],\n};\n\nlet config: z.infer<typeof configSchema>;\n\nexport const githubComicsPlugin: Plugin = {\n  name: 'plugin-github-comics',\n  description: 'Turn GitHub repos into comic strips',\n  config: {},\n  async init(cfg: Record<string, string>) {\n    config = await configSchema.parseAsync(cfg);\n  },\n  actions: [generateComicAction],\n};\n\nexport default githubComicsPlugin;\n"],"mappings":";AAEA,SAAS,SAAS;AAClB,OAAO,WAAW;AAElB,IAAM,eAAe,EAAE,OAAO;AAAA,EAC5B,gBAAgB,EAAE,OAAO,EAAE,IAAI,GAAG,4BAA4B;AAAA,EAC9D,cAAc,EAAE,OAAO,EAAE,SAAS;AACpC,CAAC;AAOD,eAAsB,kBAAkB,MAAc,OAAqC;AACzF,QAAM,MAAM,gCAAgC,IAAI;AAChD,QAAM,UAAkC,EAAE,QAAQ,8BAA8B;AAChF,MAAI,MAAO,SAAQ,gBAAgB,UAAU,KAAK;AAClD,QAAM,MAAM,MAAM,MAAM,KAAK,EAAE,QAAQ,CAAC;AACxC,MAAI,CAAC,IAAI,IAAI;AACX,UAAM,IAAI,MAAM,6BAA6B,IAAI,KAAK,IAAI,MAAM,IAAI,IAAI,UAAU,EAAE;AAAA,EACtF;AACA,QAAM,OAAQ,MAAM,IAAI,KAAK;AAC7B,SAAO,KAAK,IAAI,CAAC,UAAU,EAAE,MAAM,KAAK,MAAM,aAAa,KAAK,YAAY,EAAE;AAChF;AAEO,SAAS,kBAAkB,OAAmB,MAAsB;AACzE,QAAM,MAAM,MAAM,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,EAAE,IAAI,KAAK,EAAE,eAAe,gBAAgB,EAAE,EAAE,KAAK,IAAI;AACrG,SAAO,2DAA2D,IAAI;AAAA,EAAqB,GAAG;AAChG;AAWA,eAAsB,mBAAmB,QAAgB,QAAsC;AAC7F,QAAM,MAAM,MAAM,MAAM,gDAAgD;AAAA,IACtE,QAAQ;AAAA,IACR,SAAS;AAAA,MACP,gBAAgB;AAAA,MAChB,eAAe,UAAU,MAAM;AAAA,IACjC;AAAA,IACA,MAAM,KAAK,UAAU,EAAE,OAAO,YAAY,OAAO,CAAC;AAAA,EACpD,CAAC;AACD,MAAI,CAAC,IAAI,IAAI;AACX,UAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,UAAM,IAAI,MAAM,iBAAiB,IAAI,MAAM,IAAI,IAAI,EAAE;AAAA,EACvD;AACA,QAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,SAAO,EAAE,KAAK,KAAK,KAAK,CAAC,EAAE,IAAI;AACjC;AAEA,IAAM,sBAA8B;AAAA,EAClC,MAAM;AAAA,EACN,SAAS,CAAC,aAAa;AAAA,EACvB,aAAa;AAAA,EACb,UAAU,YAAY;AAAA,EACtB,SAAS,OACP,UACA,SACA,QACA,SACA,aACG;AACH,UAAM,OAAO,SAAS,QAAQ,QAAQ,QAAQ,MAAM,KAAK;AACzD,QAAI,CAAC,KAAM,OAAM,IAAI,MAAM,2BAA2B;AACtD,UAAM,EAAE,gBAAgB,aAAa,IAAI;AACzC,UAAM,QAAQ,MAAM,kBAAkB,MAAM,YAAY;AACxD,UAAM,SAAS,kBAAkB,OAAO,IAAI;AAC5C,UAAM,QAAQ,MAAM,mBAAmB,QAAQ,cAAc;AAC7D,UAAM,OAAO,OAAO,IAAI;AACxB,UAAM,UAAmB;AAAA,MACvB,MAAM,GAAG,IAAI;AAAA,EAAK,MAAM,GAAG;AAAA,IAC7B;AACA,UAAM,SAAS,OAAO;AACtB,WAAO;AAAA,EACT;AAAA,EACA,UAAU,CAAC;AACb;AAEA,IAAI;AAEG,IAAM,qBAA6B;AAAA,EACxC,MAAM;AAAA,EACN,aAAa;AAAA,EACb,QAAQ,CAAC;AAAA,EACT,MAAM,KAAK,KAA6B;AACtC,aAAS,MAAM,aAAa,WAAW,GAAG;AAAA,EAC5C;AAAA,EACA,SAAS,CAAC,mBAAmB;AAC/B;AAEA,IAAO,gBAAQ;","names":[]}